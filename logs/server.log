INFO:     Will watch for changes in these directories: ['/Users/stevencohen/Projects/universal_recycling/orders_project/backend']
INFO:     Uvicorn running on http://0.0.0.0:8004 (Press CTRL+C to quit)
INFO:     Started reloader process [19234] using StatReload
INFO:root:Database initialized successfully.
INFO:root:‚úÖ Database initialized successfully.
INFO:     Started server process [19285]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
DEBUG: Current working directory is: /Users/stevencohen/Projects/universal_recycling/orders_project
INFO:     127.0.0.1:51178 - "GET / HTTP/1.1" 302 Found
INFO:     127.0.0.1:51178 - "GET /login HTTP/1.1" 200 OK
INFO:     127.0.0.1:51178 - "GET /static/js/login.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:51178 - "GET /favicon.ico HTTP/1.1" 200 OK
INFO:backend.endpoints.auth:User steven logged in successfully. Permissions: ['new_order', 'pending_orders', 'received_orders', 'partially_delivered_orders', 'audit_trail', 'my_authorisations', 'cod_orders', 'maintenance', 'draft_orders', 'edit_order_admin']
INFO:     127.0.0.1:51180 - "POST /login HTTP/1.1" 200 OK
DEBUG:backend.utils.permissions_utils:Permissions check for screen_code: 'new_order' initiated.
DEBUG:backend.utils.permissions_utils:User object in session: {'id': 14, 'username': 'steven', 'rights': 'edit', 'auth_threshold_band': 5}
DEBUG:backend.utils.permissions_utils:User 'steven' (ID: 14) has permissions: ['new_order', 'pending_orders', 'received_orders', 'partially_delivered_orders', 'audit_trail', 'my_authorisations', 'cod_orders', 'maintenance', 'draft_orders', 'edit_order_admin']
DEBUG:backend.utils.permissions_utils:User 'steven' successfully authorized for 'new_order'.
INFO:root:Starting to render new order page
INFO:     127.0.0.1:51180 - "GET /orders/new HTTP/1.1" 200 OK
INFO:     127.0.0.1:51180 - "GET /static/js/new_order_main.js?v=1 HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:51193 - "GET /static/js/new_order_screen/submit_utils.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:51180 - "GET /static/js/new_order_screen/submit_draft_order_utils.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:51195 - "GET /static/js/components/fuzzy_dropdown.js HTTP/1.1" 304 Not Modified
INFO:root:Requesters fetched: 15 items
INFO:     127.0.0.1:51195 - "GET /lookups/requesters HTTP/1.1" 200 OK
INFO:root:Suppliers fetched: 803 items
INFO:     127.0.0.1:51195 - "GET /lookups/suppliers HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51195 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51195 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:     127.0.0.1:51195 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:     127.0.0.1:51195 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:     127.0.0.1:51195 - "GET /lookups/settings HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51195 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:     127.0.0.1:51180 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:     127.0.0.1:51201 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
DEBUG:backend.utils.permissions_utils:Permissions check for screen_code: 'pending_orders' initiated.
DEBUG:backend.utils.permissions_utils:User object in session: {'id': 14, 'username': 'steven', 'rights': 'edit', 'auth_threshold_band': 5}
DEBUG:backend.utils.permissions_utils:User 'steven' (ID: 14) has permissions: ['new_order', 'pending_orders', 'received_orders', 'partially_delivered_orders', 'audit_trail', 'my_authorisations', 'cod_orders', 'maintenance', 'draft_orders', 'edit_order_admin']
DEBUG:backend.utils.permissions_utils:User 'steven' successfully authorized for 'pending_orders'.
INFO:     127.0.0.1:51231 - "GET /orders/pending_orders HTTP/1.1" 200 OK
INFO:     127.0.0.1:51231 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:51233 - "GET /static/js/pending_orders.js HTTP/1.1" 304 Not Modified
INFO:     127.0.0.1:51233 - "GET /static/js/components/expand_line_items.js HTTP/1.1" 304 Not Modified
INFO:root:Requesters fetched: 15 items
INFO:     127.0.0.1:51233 - "GET /lookups/requesters HTTP/1.1" 200 OK
INFO:root:Suppliers fetched: 803 items
INFO:     127.0.0.1:51231 - "GET /lookups/suppliers HTTP/1.1" 200 OK
INFO:     127.0.0.1:51231 - "GET /orders/api/pending_orders HTTP/1.1" 200 OK
INFO:root:Generating PDF for order_id=406, order_number=2303
INFO:     127.0.0.1:51231 - "GET /orders/api/generate_pdf_for_order/406 HTTP/1.1" 200 OK
INFO:root:üì© Attempting to send PDF for order 2303 to steven.cohen714@gmail.com
INFO:root:Email Reply-To set to: aaron@urc.co.za
INFO:root:Email sent to steven.cohen714@gmail.com with subject 'Purchase Order 2303 from Universal Recycling'
INFO:root:‚úÖ Email sent for order 2303 to steven.cohen714@gmail.com and logged to audit trail.
INFO:     127.0.0.1:51283 - "POST /email/send_pdf HTTP/1.1" 200 OK
INFO:     127.0.0.1:51331 - "GET /orders/attachments/406 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51331 - "GET /orders/attachments/406 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51369 - "POST /orders/upload_attachment HTTP/1.1" 200 OK
INFO:     127.0.0.1:51369 - "GET /orders/attachments/406 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51369 - "GET /orders/attachments/406 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51369 - "GET /orders/attachments/406 HTTP/1.1" 200 OK
INFO:     127.0.0.1:51369 - "GET /data/uploads/406_7_Stretches.pdf HTTP/1.1" 200 OK
DEBUG:backend.utils.permissions_utils:Permissions check for screen_code: 'new_order' initiated.
DEBUG:backend.utils.permissions_utils:User object in session: {'id': 14, 'username': 'steven', 'rights': 'edit', 'auth_threshold_band': 5}
DEBUG:backend.utils.permissions_utils:User 'steven' (ID: 14) has permissions: ['new_order', 'pending_orders', 'received_orders', 'partially_delivered_orders', 'audit_trail', 'my_authorisations', 'cod_orders', 'maintenance', 'draft_orders', 'edit_order_admin']
DEBUG:backend.utils.permissions_utils:User 'steven' successfully authorized for 'new_order'.
INFO:root:Starting to render new order page
INFO:     127.0.0.1:51581 - "GET /orders/new HTTP/1.1" 200 OK
INFO:     127.0.0.1:51581 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:root:Requesters fetched: 15 items
INFO:     127.0.0.1:51581 - "GET /lookups/requesters HTTP/1.1" 200 OK
INFO:root:Suppliers fetched: 803 items
INFO:     127.0.0.1:51581 - "GET /lookups/suppliers HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51581 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51581 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:     127.0.0.1:51581 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:     127.0.0.1:51581 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:     127.0.0.1:51581 - "GET /lookups/settings HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51581 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:     127.0.0.1:51583 - "GET /lookups/projects HTTP/1.1" 200 OK
INFO:client:INFO | submitOrder started (finalizing order) | {"orderNumber": "2304", "draftId": ""}
INFO:     127.0.0.1:51651 - "POST /log HTTP/1.1" 200 OK
INFO:root:üîç Incoming order: order_number='2304' status='Pending' order_note='' note_to_supplier='' supplier_id=584 requester_id=12 payment_terms='On account' created_date='2025-07-25' auth_band_required=None items=[OrderItemCreate(item_code='ABRA002', item_description='CUTTING DISC STONE 115 MM', project='AD01M', qty_ordered=1.0, price=532.0)] draft_id=None
INFO:root:‚úÖ [ORDER] Success created: Order 2304 with status Pending and total R532.0
INFO:     127.0.0.1:51651 - "POST /orders HTTP/1.1" 200 OK
INFO:client:INFO | Order submitted successfully | {"orderNumber": "2304", "orderId": 407, "status": "Pending"}
INFO:     127.0.0.1:51651 - "POST /log HTTP/1.1" 200 OK
INFO:     127.0.0.1:51651 - "PUT /lookups/order_number HTTP/1.1" 200 OK
INFO:client:INFO | Order number incremented in backend settings | {"oldNum": "2304", "newNum": "2305"}
INFO:     127.0.0.1:51651 - "POST /log HTTP/1.1" 200 OK
INFO:root:Items fetched: 10056 items
INFO:     127.0.0.1:51651 - "GET /lookups/items HTTP/1.1" 200 OK
INFO:     127.0.0.1:51661 - "GET /lookups/projects HTTP/1.1" 200 OK
DEBUG:backend.utils.permissions_utils:Permissions check for screen_code: 'pending_orders' initiated.
DEBUG:backend.utils.permissions_utils:User object in session: {'id': 14, 'username': 'steven', 'rights': 'edit', 'auth_threshold_band': 5}
DEBUG:backend.utils.permissions_utils:User 'steven' (ID: 14) has permissions: ['new_order', 'pending_orders', 'received_orders', 'partially_delivered_orders', 'audit_trail', 'my_authorisations', 'cod_orders', 'maintenance', 'draft_orders', 'edit_order_admin']
DEBUG:backend.utils.permissions_utils:User 'steven' successfully authorized for 'pending_orders'.
INFO:     127.0.0.1:51651 - "GET /orders/pending_orders HTTP/1.1" 200 OK
INFO:     127.0.0.1:51651 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:root:Requesters fetched: 15 items
INFO:     127.0.0.1:51661 - "GET /lookups/requesters HTTP/1.1" 200 OK
INFO:root:Suppliers fetched: 803 items
INFO:     127.0.0.1:51651 - "GET /lookups/suppliers HTTP/1.1" 200 OK
INFO:     127.0.0.1:51651 - "GET /orders/api/pending_orders HTTP/1.1" 200 OK
INFO:     127.0.0.1:51739 - "GET /orders/api/pending_orders?requester=Eddy HTTP/1.1" 200 OK
INFO:     127.0.0.1:51739 - "GET /orders/api/pending_orders HTTP/1.1" 200 OK
INFO:     127.0.0.1:51739 - "GET /orders/api/pending_orders?status=Pending HTTP/1.1" 200 OK
